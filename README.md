# 数字孪生智慧农田大屏（东区地块数据版）

> 卫星遥感 × 物联网传感器 × 光照控制的水稻数字孪生可视化系统  
> 前后端联动，基于 Excel 数据集实时渲染 3D 场景与监测面板。

## 我们要实现什么
- 把农田传感/遥感数据“看得见”：用 Three.js 3D 场景和多面板联动，快速定位田块健康度、阶段、关键指标。
- “所见即所得”的调控雏形：补光/调试面板、阈值策略示例，可映射到真实物联网设备。
- 数据驱动的分析视图：长势/叶绿素/LAI/株高等指标时间序列，产量/生产力趋势，生长进度。
- 面向东区地块的实数展示：直接读取 11 个 Excel 文件（长势、成熟、叶绿素、LAI、株高、氮/磷/钾、pH、有机质、盐分）。

## 已完成功能
- **数据直读**：后端无需数据库，启动即解析 Excel，提供 `/api/fields/status`、`/history`、`/metrics`，支持 `/api/reload` 热加载。
- **3D 场景**：网格田块 + 稻丛随生育阶段/健康度变化；选中/悬停高亮；补光状态视觉提示。
- **仪表盘**：左侧指标卡片，右侧控制/图表，底部全周期状态条；新增“总览/分析/全屏场景”三种视图切换。
- **指标图表**：长势/叶绿素/LAI/株高折线对比，产量/生产力趋势，生长进度曲线。
- **性能优化**：前端 store 对历史/指标做字段级缓存；切换田块不重复请求。构建通过（`npm run build`）。

## 技术栈
- 前端：React 18 + TypeScript + Vite + Tailwind + Zustand 状态管理 + Three.js(@react-three/fiber/drei) + Recharts。
- 后端：Node.js + Express + XLSX（直接读 Excel）。
- 数据：11 份 Excel；地图底图提取到 `public/maps/`。

## 运行
```bash
# 前端
npm install
npm run dev
# 后端
cd backend
npm install
npm start  # 默认读取 F:\数字孪生-智慧农业项目\东区地块
# 如需更换数据目录
# set DATA_DIR=D:\path\to\东区地块
# npm start
```

## 数据口径（按文件名前缀）
- 11：作物长势指数 (growthIndex)
- 16：成熟期预测 (maturity)
- 43：叶绿素 (chlorophyll)
- 434：叶面积指数 (lai)
- 435：株高 (plantHeight)
- 131/132/133：氮/磷/钾
- 134：土壤 pH
- 135：有机质
- 136：可溶性总盐分

## 交互视图
- **总览**：3D 场景居中放大；左侧关键/环境指标；右侧控制面板 + 指标图表；底部全周期状态条。
- **分析**：双列大图表（指标对比、产量趋势、生长进度），便于汇报/对比。
- **全屏场景**：纯 3D 视图，适合展示或巡检。

## 项目优点
- **零数据库依赖**：放入新 Excel 即可运行，接口 `/api/reload` 热加载。
- **高耦合度的可视联动**：数据变化直接驱动 3D、图表、卡片一致更新。
- **性能友好**：前端缓存历史/指标；Node 端启动时一次解析，接口直接内存读取。
- **可扩展性**：指标映射表集中在 `backend/index.js`，可按传感器/模型扩展；前端指标/图表通过配置可增减。
- **地图资产就绪**：`public/maps/image1..4` 可用于背景/参考。

## 后续可选方向
1) 二级模块深化：在“分析”增加病虫害/风险预警分层；为“全屏场景”叠加热力/分区高亮。
2) 数据同步：定时监听目录变更，自动 `/api/reload`，或接入 MQTT/REST 推送。
3) 设备闭环：将补光/阈值策略抽象成 API，下发到边缘网关实现真实控制。
